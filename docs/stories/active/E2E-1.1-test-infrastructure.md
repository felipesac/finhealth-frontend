# Story E2E-1.1: Test infrastructure — auth helpers, fixtures, Page Object Model

**Epic:** FINHEALTH-EPIC-2 (E2E Test Expansion)
**Sprint:** 1 — Foundation + Core Business
**Points:** 5
**Priority:** Critical
**Status:** Pending
**Agent:** @dev

---

## Context

All 6 existing E2E specs run unauthenticated — there's no way to test any page behind the login wall. This story establishes the foundational infrastructure that all other E2E stories depend on.

## Acceptance Criteria

- [ ] Create `e2e/fixtures/auth.ts` — Playwright fixture that logs in once and saves `storageState`
- [ ] Create `e2e/fixtures/seed.ts` — Helper functions to create/cleanup test data via Supabase client or API calls
- [ ] Create `e2e/pages/login.page.ts` — Page Object Model for login page (refactor existing login.spec.ts)
- [ ] Create `e2e/pages/dashboard.page.ts` — Page Object Model for dashboard
- [ ] Create `e2e/pages/sidebar.page.ts` — Page Object Model for sidebar navigation
- [ ] Update `playwright.config.ts` to support authenticated project with `storageState`
- [ ] Add `e2e/global-setup.ts` for one-time auth bootstrap
- [ ] Create `.env.test` example with test credentials documentation
- [ ] Verify: `npx playwright test` runs existing + new infrastructure tests
- [ ] Add at least 1 authenticated smoke test (login → see dashboard)

## Technical Notes

- Use Playwright `storageState` pattern: login once in global-setup, reuse cookies across all tests
- Page Object Model encapsulates selectors: if UI changes, only POM files need updating
- Seed helpers should use `@supabase/supabase-js` with service_role key for direct DB access
- Consider `test.describe.configure({ mode: 'serial' })` for flows that depend on data state

## Files to Create

- `e2e/fixtures/auth.ts`
- `e2e/fixtures/seed.ts`
- `e2e/pages/login.page.ts`
- `e2e/pages/dashboard.page.ts`
- `e2e/pages/sidebar.page.ts`
- `e2e/global-setup.ts`
- `.env.test.example`

## Files to Modify

- `playwright.config.ts`
- `e2e/login.spec.ts` (refactor to use POM)

## Definition of Done

- [ ] Authenticated test fixture works end-to-end
- [ ] At least 1 test runs behind the login wall
- [ ] Page Object Model established for 3 pages
- [ ] Existing 25 E2E tests still pass
