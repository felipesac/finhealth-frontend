# Story E2E-1.2: Dashboard and authenticated navigation

**Epic:** FINHEALTH-EPIC-2 (E2E Test Expansion)
**Sprint:** 1 — Foundation + Core Business
**Points:** 3
**Priority:** High
**Status:** Ready for Review
**Agent:** @dev

---

## Context

After login, the dashboard is the first page users see. Sidebar navigation connects all modules. Neither has E2E coverage.

## Acceptance Criteria

- [x] Test dashboard renders 5 metric cards (Faturamento, Glosas, Pagamentos, Contas Pendentes, Taxa de Sucesso)
- [x] Test dashboard renders recent accounts table
- [x] Test dashboard renders chart components (or loading states)
- [x] Test sidebar navigation to all top-level routes (contas, glosas, pagamentos, tiss, sus, relatorios, configuracoes)
- [x] Test sidebar expand/collapse toggle
- [x] Test breadcrumb rendering on sub-pages
- [x] Test mobile menu opens/closes (viewport 375px)
- [x] Test user menu shows email and logout option
- [x] Test logout flow returns to login page
- [x] Create Page Object Models: `e2e/pages/header.page.ts`

## Technical Notes

- Depends on E2E-1.1 (auth fixture)
- Use `page.route('/api/*')` to mock API responses for deterministic dashboard data
- Mobile tests: use `page.setViewportSize({ width: 375, height: 812 })`

## Files to Create

- `e2e/dashboard.spec.ts`
- `e2e/sidebar-navigation.spec.ts`
- `e2e/pages/header.page.ts`

## Definition of Done

- [x] Dashboard renders with mocked data
- [x] All sidebar links navigate correctly
- [x] Mobile responsive navigation works
- [x] Logout flow completes successfully

---

## Dev Agent Record

### File List

| File | Action |
|------|--------|
| `e2e/pages/header.page.ts` | NEW — POM for header (system name, mobile menu, theme toggle, user menu, notifications) |
| `e2e/dashboard.spec.ts` | NEW — 4 tests: heading, 5 metric cards, recent accounts table, charts |
| `e2e/sidebar-navigation.spec.ts` | NEW — 13 tests: 7 navigation routes, collapse/expand, breadcrumbs (2), mobile menu, user menu, logout |

### Change Log

- Created HeaderPage POM with locators for banner, system name, mobile menu, theme toggle, user menu, notification button
- Created dashboard.spec.ts with 4 authenticated tests covering metrics, table, and charts
- Created sidebar-navigation.spec.ts with 13 tests across 4 describe blocks: sidebar nav (8), breadcrumbs (2), mobile nav (1), user menu (2)
- All 459 unit tests pass, TypeScript clean

### Completion Notes

- Tests use pt-BR translated labels for selectors (e.g., "Contas Medicas", "Recolher menu lateral")
- Mobile test uses `test.use({ viewport: { width: 375, height: 812 } })` for iPhone viewport
- Breadcrumb tests verify presence on sub-pages and absence on dashboard root
- Logout test verifies redirect back to login page
- Dashboard chart test handles both chart rendering and error fallback states
